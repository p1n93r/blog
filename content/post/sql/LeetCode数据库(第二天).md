---
typora-root-url: ../../../static
title: "LeetCodeæ•°æ®åº“(ç¬¬äºŒå¤©)"
date: 2020-09-16T23:06:36+08:00
draft: false
categories: ["sql"]
---

## [178]åˆ†æ•°æ’å
é¢˜ç›®å†…å®¹å¦‚ä¸‹ï¼š

	//ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥å®ç°åˆ†æ•°æ’åã€‚
	//
	// å¦‚æœä¸¤ä¸ªåˆ†æ•°ç›¸åŒï¼Œåˆ™ä¸¤ä¸ªåˆ†æ•°æ’åï¼ˆRankï¼‰ç›¸åŒã€‚è¯·æ³¨æ„ï¼Œå¹³åˆ†åçš„ä¸‹ä¸€ä¸ªåæ¬¡åº”è¯¥æ˜¯ä¸‹ä¸€ä¸ªè¿ç»­çš„æ•´æ•°å€¼ã€‚æ¢å¥è¯è¯´ï¼Œåæ¬¡ä¹‹é—´ä¸åº”è¯¥æœ‰â€œé—´éš”â€ã€‚
	//
	// +----+-------+
	//| Id | Score |
	//+----+-------+
	//| 1  | 3.50  |
	//| 2  | 3.65  |
	//| 3  | 4.00  |
	//| 4  | 3.85  |
	//| 5  | 4.00  |
	//| 6  | 3.65  |
	//+----+-------+
	//
	//
	// ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„ Scores è¡¨ï¼Œä½ çš„æŸ¥è¯¢åº”è¯¥è¿”å›ï¼ˆæŒ‰åˆ†æ•°ä»é«˜åˆ°ä½æ’åˆ—ï¼‰ï¼š
	//
	// +-------+------+
	//| Score | Rank |
	//+-------+------+
	//| 4.00  | 1    |
	//| 4.00  | 1    |
	//| 3.85  | 2    |
	//|Â 3.65  | 3    |
	//| 3.65  | 3    |
	//| 3.50  | 4    |
	//+-------+------+
	//
	//
	// é‡è¦æç¤ºï¼šå¯¹äº MySQL è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœè¦è½¬ä¹‰ç”¨ä½œåˆ—åçš„ä¿ç•™å­—ï¼Œå¯ä»¥åœ¨å…³é”®å­—ä¹‹å‰å’Œä¹‹åä½¿ç”¨æ’‡å·ã€‚ä¾‹å¦‚ `Rank`
	// ğŸ‘ 600 ğŸ‘ 0

### è§£æ³•
ä¸€å¼€å§‹æƒ³ï¼Œmysqlä¼šä¸ä¼šæœ‰ä»€ä¹ˆç³»ç»Ÿå‡½æ•°å¯ä»¥å¾—åˆ°å½“å‰è¡Œçš„ç´¢å¼•ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°æ’åäº†ï¼Œå¥½çš„ï¼Œmysqlä½ç‰ˆæœ¬æ˜¯æ²¡æœ‰è¿™ç§å‡½æ•°çš„ï¼Œé«˜ç‰ˆæœ¬æœ‰ä¸€ä¸ªdense_rank()å‡½æ•°å¯ä»¥ç›´æ¥å¾—åˆ°æ’åã€‚ä½†æ˜¯æˆ‘æœ¬åœ°æ˜¯ä½ç‰ˆæœ¬çš„ï¼Œäºæ˜¯ã€‚ã€‚ã€‚æˆ‘ä¸ä¼šåšäº†ï¼Œçœ‹äººå®¶çš„é¢˜è§£å­=-='''æ€è·¯å°±æ˜¯ï¼š **å‡è®¾å½“å‰åˆ†æ•°æ˜¯Xï¼Œé‚£ä¹ˆæŸ¥æ‰¾å¤§äºXçš„ä¸é‡å¤ä¸ªæ•°ï¼ˆå¹³åˆ†çš„äººæ˜¯åŒä¸ªåæ¬¡ï¼‰Gï¼Œé‚£ä¹ˆG+1å°±æ˜¯åˆ†æ•°Xçš„åæ¬¡** ï¼Œä»£ç å¦‚ä¸‹ï¼š

	select Score,(
	        select count(distinct Score)+1 from Scores a where a.Score>b.Score
	) as `Rank` from Scores b order by Score desc;

## [180]è¿ç»­å‡ºç°çš„æ•°å­—
é¢˜ç›®å†…å®¹å¦‚ä¸‹ï¼š

	//ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥æ‰¾æ‰€æœ‰è‡³å°‘è¿ç»­å‡ºç°ä¸‰æ¬¡çš„æ•°å­—ã€‚
	//
	// +----+-----+
	//| Id | Num |
	//+----+-----+
	//| 1  |  1  |
	//| 2  |  1  |
	//| 3  |  1  |
	//| 4  |  2  |
	//| 5  |  1  |
	//| 6  |  2  |
	//| 7  |  2  |
	//+----+-----+
	//
	//
	// ä¾‹å¦‚ï¼Œç»™å®šä¸Šé¢çš„ Logs è¡¨ï¼Œ 1 æ˜¯å”¯ä¸€è¿ç»­å‡ºç°è‡³å°‘ä¸‰æ¬¡çš„æ•°å­—ã€‚
	//
	// +-----------------+
	//| ConsecutiveNums |
	//+-----------------+
	//| 1               |
	//+-----------------+
	//
	// ğŸ‘ 305 ğŸ‘ 0

### è§£æ³•
è‡³å°‘è¿ç»­å‡ºç°ä¸‰æ¬¡ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯è¿ç»­çš„ä¸‰è¡Œï¼Œé‚£ä¹ˆå®ƒä»¬çš„idä¹Ÿæ˜¯è¿ç»­çš„ä¸”numç›¸ç­‰ï¼Œæ ¹æ®è¿™ä¸ªæ¡ä»¶ï¼Œæ„é€ æŸ¥è¯¢å¦‚ä¸‹ï¼š

	select distinct a.Num as ConsecutiveNums from Logs a,Logs b,Logs c
	        where a.Id+1=b.Id and b.Id+1=c.Id
	            and a.Num=b.Num and b.Num=c.Num;

## [181]è¶…è¿‡ç»ç†æ”¶å…¥çš„å‘˜å·¥
é¢˜ç›®å†…å®¹å¦‚ä¸‹ï¼š

	//Employee è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ï¼Œä»–ä»¬çš„ç»ç†ä¹Ÿå±äºå‘˜å·¥ã€‚æ¯ä¸ªå‘˜å·¥éƒ½æœ‰ä¸€ä¸ª Idï¼Œæ­¤å¤–è¿˜æœ‰ä¸€åˆ—å¯¹åº”å‘˜å·¥çš„ç»ç†çš„ Idã€‚
	//
	// +----+-------+--------+-----------+
	//| Id | Name  | Salary | ManagerId |
	//+----+-------+--------+-----------+
	//| 1  | Joe   | 70000  | 3         |
	//| 2  | Henry | 80000  | 4         |
	//| 3  | Sam   | 60000  | NULL      |
	//| 4  | Max   | 90000  | NULL      |
	//+----+-------+--------+-----------+
	//
	//
	// ç»™å®š Employee è¡¨ï¼Œç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè¯¥æŸ¥è¯¢å¯ä»¥è·å–æ”¶å…¥è¶…è¿‡ä»–ä»¬ç»ç†çš„å‘˜å·¥çš„å§“åã€‚åœ¨ä¸Šé¢çš„è¡¨æ ¼ä¸­ï¼ŒJoe æ˜¯å”¯ä¸€ä¸€ä¸ªæ”¶å…¥è¶…è¿‡ä»–çš„ç»ç†çš„å‘˜å·¥ã€‚
	//
	//
	// +----------+
	//| Employee |
	//+----------+
	//| Joe      |
	//+----------+
	//
	// ğŸ‘ 308 ğŸ‘ 0

### è§£æ³•
é€šè¿‡Idå’ŒManagerIdè¿æ¥èµ·æ¥ä¸¤æ¡è®°å½•ï¼Œç„¶åæ¯”è¾ƒå…¶Salaryï¼Œä»£ç å¦‚ä¸‹ï¼š

	select a.Name as Employee from Employee a,Employee b where a.ManagerId=b.Id and a.Salary>b.Salary;

## [182]æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±
é¢˜ç›®å†…å®¹å¦‚ä¸‹ï¼š

	//ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥æ‰¾ Person è¡¨ä¸­æ‰€æœ‰é‡å¤çš„ç”µå­é‚®ç®±ã€‚
	//
	// ç¤ºä¾‹ï¼š
	//
	// +----+---------+
	//| Id | Email   |
	//+----+---------+
	//| 1  | a@b.com |
	//| 2  | c@d.com |
	//| 3  | a@b.com |
	//+----+---------+
	//
	//
	// æ ¹æ®ä»¥ä¸Šè¾“å…¥ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹ç»“æœï¼š
	//
	// +---------+
	//| Email   |
	//+---------+
	//| a@b.com |
	//+---------+
	//
	//
	// è¯´æ˜ï¼šæ‰€æœ‰ç”µå­é‚®ç®±éƒ½æ˜¯å°å†™å­—æ¯ã€‚
	// ğŸ‘ 229 ğŸ‘ 0

### è§£æ³•
æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ª `group by` ï¼Œéœ€è¦æ³¨æ„çš„å°±æ˜¯èšåˆå‡½æ•°å¯ä»¥æ”¾åœ¨ `having` åé¢ä½œä¸ºæ¡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š

	select Email from Person group by Email having count(*)>1;

## [183]ä»ä¸è®¢è´­çš„å®¢æˆ·
é¢˜ç›®å†…å®¹å¦‚ä¸‹ï¼š

	//æŸç½‘ç«™åŒ…å«ä¸¤ä¸ªè¡¨ï¼ŒCustomers è¡¨å’Œ Orders è¡¨ã€‚ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ‰€æœ‰ä»ä¸è®¢è´­ä»»ä½•ä¸œè¥¿çš„å®¢æˆ·ã€‚
	//
	// Customers è¡¨ï¼š
	//
	// +----+-------+
	//| Id | Name  |
	//+----+-------+
	//| 1  | Joe   |
	//| 2  | Henry |
	//| 3  | Sam   |
	//| 4  | Max   |
	//+----+-------+
	//
	//
	// Orders è¡¨ï¼š
	//
	// +----+------------+
	//| Id | CustomerId |
	//+----+------------+
	//| 1  | 3          |
	//| 2  | 1          |
	//+----+------------+
	//
	//
	// ä¾‹å¦‚ç»™å®šä¸Šè¿°è¡¨æ ¼ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ï¼š
	//
	// +-----------+
	//| Customers |
	//+-----------+
	//| Henry     |
	//| Max       |
	//+-----------+
	//
	// ğŸ‘ 172 ğŸ‘ 0

### è§£æ³•
æ¯”è¾ƒç®€å•ï¼Œç”¨ `not in` å°±å¯ä»¥å•¦ï¼Œä»£ç å¦‚ä¸‹ï¼š

	select Name as Customers from Customers where Id not in(
	        select distinct CustomerId from Orders
	);

## [184]éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥
é¢˜ç›®å†…å®¹å¦‚ä¸‹ï¼š

	//Employee è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œæ¯ä¸ªå‘˜å·¥æœ‰å…¶å¯¹åº”çš„ Id, salary å’Œ department Idã€‚
	//
	// +----+-------+--------+--------------+
	//| Id | Name  | Salary | DepartmentId |
	//+----+-------+--------+--------------+
	//| 1  | Joe   | 70000  | 1            |
	//| 2 Â | Jim Â  | 90000 Â | 1 Â  Â  Â  Â  Â  Â |
	//| 3  | Henry | 80000  | 2            |
	//| 4  | Sam   | 60000  | 2            |
	//| 5  | Max   | 90000  | 1            |
	//+----+-------+--------+--------------+
	//
	// Department è¡¨åŒ…å«å…¬å¸æ‰€æœ‰éƒ¨é—¨çš„ä¿¡æ¯ã€‚
	//
	// +----+----------+
	//| Id | Name     |
	//+----+----------+
	//| 1  | IT       |
	//| 2  | Sales    |
	//+----+----------+
	//
	// ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥ã€‚å¯¹äºä¸Šè¿°è¡¨ï¼Œæ‚¨çš„ SQL æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹è¡Œï¼ˆè¡Œçš„é¡ºåºæ— å…³ç´§è¦ï¼‰ã€‚
	//
	// +------------+----------+--------+
	//| Department | Employee | Salary |
	//+------------+----------+--------+
	//| IT         | Max      | 90000  |
	//| IT Â  Â  Â  Â  | Jim Â  Â  Â | 90000 Â |
	//| Sales      | Henry    | 80000  |
	//+------------+----------+--------+
	//
	// è§£é‡Šï¼š
	//
	// Max å’Œ Jim åœ¨ IT éƒ¨é—¨çš„å·¥èµ„éƒ½æ˜¯æœ€é«˜çš„ï¼ŒHenry åœ¨é”€å”®éƒ¨çš„å·¥èµ„æœ€é«˜ã€‚
	// ğŸ‘ 287 ğŸ‘ 0

### è§£æ³•
ä¸€å¼€å§‹æƒ³åˆ°äº† `IN` ï¼Œä½†æ˜¯ä¸çŸ¥é“å¯ä»¥ `IN` å¤šä¸ªå­—æ®µï¼Œæ€è·¯å°±æ˜¯ï¼š **å…ˆæŸ¥è¯¢å‡ºéƒ¨é—¨IDä»¥åŠå¯¹åº”éƒ¨é—¨æœ€é«˜å·¥èµ„ï¼Œç„¶åæŸ¥è¯¢Employeeä¸­éƒ¨é—¨IDå’Œå·¥èµ„INæŸ¥è¯¢å‡ºæ¥çš„ç»“æœï¼ˆINçš„å­—æ®µè¦å¯¹åº”ï¼‰** ï¼Œä»£ç å¦‚ä¸‹ï¼š

	select D.Name as Department,E.Name as Employee,E.Salary as Salary
	        from Department D,Employee E
	        where D.Id=E.DepartmentId and (E.DepartmentId,E.Salary) in (
	        select F.DepartmentId,max(F.Salary) from Employee F group by F.DepartmentId
	    );

## [175]ç»„åˆä¸¤ä¸ªè¡¨
é¢˜ç›®å†…å®¹å¦‚ä¸‹ï¼š

	//è¡¨1: Person
	//
	// +-------------+---------+
	//| åˆ—å         | ç±»å‹     |
	//+-------------+---------+
	//| PersonId    | int     |
	//| FirstName   | varchar |
	//| LastName    | varchar |
	//+-------------+---------+
	//PersonId æ˜¯ä¸Šè¡¨ä¸»é”®
	//
	//
	// è¡¨2: Address
	//
	// +-------------+---------+
	//| åˆ—å         | ç±»å‹    |
	//+-------------+---------+
	//| AddressId   | int     |
	//| PersonId    | int     |
	//| City        | varchar |
	//| State       | varchar |
	//+-------------+---------+
	//AddressId æ˜¯ä¸Šè¡¨ä¸»é”®
	//
	//
	//
	//
	// ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ»¡è¶³æ¡ä»¶ï¼šæ— è®º person æ˜¯å¦æœ‰åœ°å€ä¿¡æ¯ï¼Œéƒ½éœ€è¦åŸºäºä¸Šè¿°ä¸¤è¡¨æä¾› person çš„ä»¥ä¸‹ä¿¡æ¯ï¼š
	//
	//
	//
	// FirstName, LastName, City, State
	//
	// ğŸ‘ 667 ğŸ‘ 0

### è§£æ³•
å°±æ˜¯ä¸€ä¸ªå·¦è¿æ¥ï¼Œä»£ç å¦‚ä¸‹ï¼š

	select FirstName,LastName,A.City,A.State from Person left join Address A on Person.PersonId = A.PersonId;

## [176]ç¬¬äºŒé«˜çš„è–ªæ°´
é¢˜ç›®å†…å®¹å¦‚ä¸‹ï¼š

	//ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè·å– Employee è¡¨ä¸­ç¬¬äºŒé«˜çš„è–ªæ°´ï¼ˆSalaryï¼‰ ã€‚
	//
	// +----+--------+
	//| Id | Salary |
	//+----+--------+
	//| 1  | 100    |
	//| 2  | 200    |
	//| 3  | 300    |
	//+----+--------+
	//
	//
	// ä¾‹å¦‚ä¸Šè¿° Employee è¡¨ï¼ŒSQLæŸ¥è¯¢åº”è¯¥è¿”å› 200 ä½œä¸ºç¬¬äºŒé«˜çš„è–ªæ°´ã€‚å¦‚æœä¸å­˜åœ¨ç¬¬äºŒé«˜çš„è–ªæ°´ï¼Œé‚£ä¹ˆæŸ¥è¯¢åº”è¿”å› nullã€‚
	//
	// +---------------------+
	//| SecondHighestSalary |
	//+---------------------+
	//| 200                 |
	//+---------------------+
	//
	// ğŸ‘ 637 ğŸ‘ 0

### è§£æ³•
è¿”å›ç¬¬äºŒé«˜ï¼Œæƒ³åˆ°ç”¨ `limit 1,1` ,ä½†æ˜¯é¢˜ç›®å¤šäº†ä¸€ä¸ªéœ€è¦è¿”å›nullçš„æ¡ä»¶ï¼Œäºæ˜¯å¯ä»¥ç”¨ `IFNULL(æ¡ä»¶,ä¸ºnullçš„ç»“æœ)` ç³»ç»Ÿå‡½æ•°æ¥å¤„ç†ã€‚ä»£ç å¦‚ä¸‹ï¼š

	select IFNULL((select distinct Salary from Employee order by Salary desc limit 1,1),null) as SecondHighestSalary;

## [177]ç¬¬Né«˜çš„è–ªæ°´
é¢˜ç›®å†…å®¹å¦‚ä¸‹ï¼š

	//ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè·å– Employee è¡¨ä¸­ç¬¬ n é«˜çš„è–ªæ°´ï¼ˆSalaryï¼‰ã€‚
	//
	// +----+--------+
	//| Id | Salary |
	//+----+--------+
	//| 1  | 100    |
	//| 2  | 200    |
	//| 3  | 300    |
	//+----+--------+
	//
	//
	// ä¾‹å¦‚ä¸Šè¿° Employee è¡¨ï¼Œn = 2 æ—¶ï¼Œåº”è¿”å›ç¬¬äºŒé«˜çš„è–ªæ°´ 200ã€‚å¦‚æœä¸å­˜åœ¨ç¬¬ n é«˜çš„è–ªæ°´ï¼Œé‚£ä¹ˆæŸ¥è¯¢åº”è¿”å› nullã€‚
	//
	// +------------------------+
	//| getNthHighestSalary(2) |
	//+------------------------+
	//| 200                    |
	//+------------------------+
	//
	// ğŸ‘ 345 ğŸ‘ 0

### è§£æ³•å¦‚ä¸‹ï¼š
è¿™ä¸ªé¢˜å’Œä¸Šä¸€ä¸ªé¢˜[176]å¾ˆç±»ä¼¼ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯ `limit offset,count` ä¸­çš„offsetæ˜¯ä»0å¼€å§‹çš„ã€‚ä»£ç å¦‚ä¸‹ï¼š

	CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT
	BEGIN
	    SET N=N-1;
	    RETURN (
	        # Write your MySQL query statement below.
	        IFNULL((select distinct Salary from Employee order by Salary desc limit N,1),null)
	    );
	END



